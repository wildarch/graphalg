\documentclass{article}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
% NOTE: needs texlive-latex-extra
\usepackage{semantic}

% From paper
\DeclareMathOperator{\schema}{\mathcal{S}}
\DeclareMathOperator{\sring}{\text{sring}}
\DeclareMathOperator{\var}{\mathrm{var}}
\DeclareMathOperator{\zero}{\underline{0}}
\DeclareMathOperator{\one}{\underline{1}}
\DeclareMathOperator{\diag}{\mathrm{diag}}
\DeclareMathOperator{\feval}{\mathrm{feval}}
\DeclareMathOperator{\type}{\mathrm{type}}
\DeclareMathOperator{\mapply}{\mathrm{apply}}

\DeclareMathOperator{\matR}{\mathrm{Mat}[R]}
\DeclareMathOperator{\Symb}{\mathrm{Symb}}
\DeclareMathOperator{\fschema}{\mathcal{F}}
\DeclareMathOperator{\dschema}{\mathcal{D}}
\DeclareMathOperator{\schemas}{\fschema, \dschema, \schema}
\DeclareMathOperator{\mat}{\text{mat}}
\DeclareMathOperator{\func}{\text{func}}

%\DeclareMathOperator{\dim}{\text{dim}}


\begin{document}

\[
  \inference[program]{
    F \vdash f_1 : \tau_1 & F[f_1 := \tau_1] \vdash f_2 : \tau_2 \\
  }{
    F \vdash f_1 \ f_2
  }
\]

\[
  \inference[function]{
    f \notin F \\
    % Parameters (must be unique)
    P_0 := \emptyset \\
    p_1 \notin P_0 & P_1 := P_0[p_1 := \tau_1] \\
    \vdots \\
    p_m \notin P_{m-1} & P_m := P_{m-1}[p_m := \tau_m] \\
    % Statements (use parameter environment, and the changes of previous statements)
    L_0 := P_m \\
    F, L_0 \vdash s_1 : L_{1} \\
    \vdots \\
    F, L_{n - 1} \vdash s_n : L_{n} \\
    % Final expr
    F, L_n \vdash e : \tau_r \\
  }{
    F \vdash \texttt{func} \ f (p_1: \tau_1, \cdots, p_m: \tau_m) \texttt{ -> } \tau_r \ \{ s_1 \cdots s_n \texttt{ return } e \texttt{;} \} : \tau_f
  }
\]

\[
  \inference[assign]{
    M_b \notin L \\
    F, L \vdash e : \tau_e \\
    L_r := L[M_b := e] \\
  }{
    F, L \vdash M_b \texttt{ = } e \texttt{;} \vdash L_r
  }
\]

\[
  \inference[reassign]{
    F, L \vdash M_b : \tau_b \\
    F, L \vdash e : \tau_e \\
    \text{if mask present: } F, L \vdash M_m : \tau_m & \dim(\tau_b) = \dim(\tau_m) \\
    (r_b, c_b) := \dim(\tau_b) & (r_e, c_e) := \dim(\tau_e) \\
    % base must be a full matrix, e a scalar
    \text{if }\texttt{[:, :]}\text{ present: } r_b \neq 1 & c_b \neq 1 & r_e = 1 & c_e = 1 \\
    % base must be a vector, e a scalar
    \text{if }\texttt{[:]}\text{ present: } r_b \neq 1 & c_b = 1 & r_e = 1 & c_e = 1 \\
    % dimensions must match
    \text{else: } r_b = r_e & c_b = c_e \\
  }{
    % Note: does not change type of M_b
    F, L \vdash M_b 
      % Note: complement case omitted because it is irrelevant for typing
      [\![ \texttt{<}M_m\texttt{>} ]\!]^?
      [\![ \texttt{[:, :]} | \texttt{[:]} ]\!]^?
      \texttt{ = }e\texttt{;} \vdash L}
\]

\[
  \inference[accum]{
    F, L \vdash M_b : \tau_b \\
    F, L \vdash e : \tau_e \\
    \tau_b = \tau_e \\
  }{
    % Note: does not change type of M_b
    F, L \vdash M_b \texttt{ += } e \texttt{;} \vdash L
  }
\]

\end{document}
